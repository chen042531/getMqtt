# PFCP Wireshark风格监听器

这是一个类似Wireshark的PFCP（Packet Forwarding Control Protocol）高级监听工具，提供详细的数据包分析和过滤功能。

## 🚀 主要特性

### 核心功能
- **实时数据包捕获**: 监听PFCP流量（端口8805）
- **详细数据包解析**: 解析PFCP消息头、SEID、序列号等
- **Wireshark风格显示**: 类似Wireshark的数据包详细信息
- **高级过滤功能**: 支持IP地址、消息类型、数据包大小过滤
- **实时统计**: 提供详细的流量统计信息

### 显示模式
- **详细模式**: 显示完整的数据包信息，包括十六进制数据
- **紧凑模式**: 简洁的数据包列表显示
- **统计模式**: 定期显示流量统计信息

## 📋 使用方法

### 基本使用

1. **编译程序**:
   ```bash
   go build -o advanced_sniffer advanced_sniffer.go
   ```

2. **以root权限运行**:
   ```bash
   sudo ./advanced_sniffer
   ```

3. **或者直接运行**:
   ```bash
   sudo go run advanced_sniffer.go
   ```

### 命令行选项

```bash
# 紧凑模式显示
sudo ./advanced_sniffer -c

# 过滤特定IP
sudo ./advanced_sniffer -f 192.168.1.100

# 组合使用
sudo ./advanced_sniffer -c -f 192.168.1.100
```

## 📊 输出示例

### 详细模式输出
```
================================================================================
数据包 #1
时间戳: 2024-01-15 15:04:05.123
源地址: 192.168.1.100:8805
目标地址: 10.0.0.1:8805
协议: PFCP
长度: 64 字节

PFCP消息详情:
  版本: 1
  消息类型: 7 (会话建立)
  长度: 64
  SEID: 123456789
  序列号: 67890

十六进制数据:
  2007004000000000075bcd150000010900000000000000000000000000000000

原始数据:
  0000: 20 07 00 40 00 00 00 00 07 5b cd 15 00 00 01 09
  0010: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
================================================================================
```

### 紧凑模式输出
```
[15:04:05.123] #1 会话建立 192.168.1.100:8805 -> 10.0.0.1:8805 (64 bytes)
[15:04:05.456] #2 心跳请求 192.168.1.100:8805 -> 10.0.0.1:8805 (16 bytes)
```

### 统计信息输出
```
================================================================================
PFCP流量详细统计
================================================================================
监听开始时间: 2024-01-15 15:04:05
监听持续时间: 5m30s
总数据包数: 150
平均速率: 0.45 包/秒
最后消息时间: 2024-01-15 15:09:35

消息类型分布:
  心跳请求: 45 (30.0%)
  会话建立: 25 (16.7%)
  会话删除: 20 (13.3%)
  关联建立: 10 (6.7%)

源IP地址分布:
  192.168.1.100: 100 (66.7%)
  10.0.0.1: 50 (33.3%)

数据包大小分布:
  16 字节: 45 (30.0%)
  64 字节: 55 (36.7%)
  128 字节: 50 (33.3%)
```

## 🔧 功能详解

### 数据包解析
- **版本信息**: PFCP协议版本
- **消息类型**: 消息类型标识和中文描述
- **SEID**: 会话端点标识符
- **序列号**: 消息序列号
- **时间戳**: 精确到毫秒的时间戳
- **IP地址**: 源和目标IP地址及端口

### 过滤功能
- **IP地址过滤**: 按源IP或目标IP过滤
- **消息类型过滤**: 按PFCP消息类型过滤
- **数据包大小过滤**: 按数据包长度过滤
- **实时过滤**: 在运行时应用过滤器

### 统计功能
- **消息类型统计**: 各类型消息的数量和百分比
- **IP地址统计**: 源和目标IP地址分布
- **数据包大小统计**: 数据包大小分布
- **速率统计**: 平均数据包速率
- **时间统计**: 监听持续时间和最后消息时间

## 🎯 支持的PFCP消息类型

| 类型 | 数值 | 描述 |
|------|------|------|
| 心跳请求 | 1 | Heartbeat Request |
| 心跳响应 | 2 | Heartbeat Response |
| PFD管理 | 3 | PFD Management |
| 关联建立 | 4 | Association Setup |
| 关联释放 | 5 | Association Release |
| 节点报告 | 6 | Node Report |
| 会话建立 | 7 | Session Setup |
| 会话修改 | 8 | Session Modify |
| 会话删除 | 9 | Session Delete |
| 会话报告 | 10 | Session Report |

## ⚙️ 配置选项

### 显示选项
- `ShowDetails`: 显示详细的消息信息
- `ShowHex`: 显示十六进制数据
- `ShowRaw`: 显示原始数据
- `CompactMode`: 紧凑显示模式
- `ShowStats`: 显示统计信息

### 过滤器选项
- `SourceIP`: 源IP地址过滤
- `DestIP`: 目标IP地址过滤
- `MessageType`: 消息类型过滤
- `MinLength`: 最小数据包长度
- `MaxLength`: 最大数据包长度

## 🔍 故障排除

### 常见问题

1. **权限不足**:
   ```
   警告: 此程序需要root权限来捕获网络数据包
   ```
   解决方案: 使用sudo运行程序

2. **端口被占用**:
   ```
   无法监听UDP端口: bind: address already in use
   ```
   解决方案: 检查是否有其他程序占用8805端口

3. **没有PFCP流量**:
   确保网络中有PFCP流量，通常来自5G核心网络设备

### 调试技巧

1. **使用紧凑模式**: 使用`-c`参数获得简洁的输出
2. **过滤特定IP**: 使用`-f`参数过滤特定IP地址
3. **查看统计信息**: 程序每60秒自动显示统计信息
4. **检查数据包大小**: 观察数据包大小分布来识别不同类型的消息

## 📈 性能优化

- **缓冲区大小**: 默认4096字节，可根据需要调整
- **超时设置**: 1秒读取超时，避免阻塞
- **内存使用**: 自动管理内存，避免内存泄漏
- **CPU使用**: 高效的数据包处理算法

## 🔒 安全注意事项

- 需要root权限进行网络数据包捕获
- 仅监听PFCP流量（端口8805）
- 不修改或转发数据包
- 仅用于网络分析和调试

## 📝 许可证

此工具仅供学习和研究使用。在生产环境中使用前，请确保符合相关法律法规和网络政策。 