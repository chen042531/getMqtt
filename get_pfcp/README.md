# PFCP即时分析工具

这是一个用于实时分析和监控PFCP（Packet Forwarding Control Protocol）流量的Go语言工具。

## 功能特性

- **实时捕获**: 监听PFCP流量（端口8805）
- **消息解析**: 解析PFCP消息头，包括版本、消息类型、SEID、序列号等
- **统计分析**: 提供详细的统计信息，包括消息类型分布、IP地址统计等
- **原始数据显示**: 显示PFCP消息的原始十六进制数据
- **中文界面**: 完全中文化的用户界面

## 支持的PFCP消息类型

- 心跳请求/响应 (Heartbeat Request/Response)
- 关联建立/释放 (Association Setup/Release)
- 会话建立/修改/删除/报告 (Session Setup/Modify/Delete/Report)
- PFD管理 (PFD Management)
- 节点报告 (Node Report)

## 安装和运行

### 前置要求

- Go 1.22.0 或更高版本
- Root权限（用于网络数据包捕获）

### 运行步骤

1. **进入项目目录**:
   ```bash
   cd get_pfcp
   ```

2. **以root权限运行**:
   ```bash
   sudo go run pfcp_analyzer.go
   ```

3. **或者编译后运行**:
   ```bash
   sudo go build -o pfcp_analyzer pfcp_analyzer.go
   sudo ./pfcp_analyzer
   ```

## 使用说明

### 基本使用

运行程序后，工具会：

1. 自动检测网络接口
2. 开始监听PFCP流量（端口8805）
3. 实时显示捕获的PFCP消息
4. 每30秒自动打印统计信息
5. 按Ctrl+C停止程序并显示最终统计

### 输出示例

```
开始监听PFCP流量...
注意: 此工具需要root权限来捕获网络数据包
请使用以下命令运行:
sudo go run pfcp_analyzer.go

正在监听端口 8805...
按Ctrl+C停止监听...

[15:04:05.123] PFCP消息: 心跳请求
  版本: 1, 长度: 16, SEID: 0, 序列号: 12345
  源: 192.168.1.100:8805
  原始数据: 20 01 00 10 00 00 00 00 00 00 30 39 00 00 00 00 ...

[15:04:05.456] PFCP消息: 会话建立
  版本: 1, 长度: 64, SEID: 123456789, 序列号: 67890
  源: 10.0.0.1:8805
  原始数据: 20 07 00 40 00 00 00 00 07 5b cd 15 00 00 01 09 ...
```

### 统计信息

程序会定期显示以下统计信息：

- 总消息数
- 各类型消息数量
- 心跳消息数量
- 会话建立/删除数量
- 关联建立数量
- 源IP和目标IP地址分布
- 最后消息时间

## 技术细节

### PFCP消息格式

PFCP消息包含以下字段：

- **版本** (Version): PFCP协议版本
- **消息类型** (Message Type): 消息类型标识
- **长度** (Length): 消息总长度
- **SEID** (Session Endpoint ID): 会话端点标识符
- **序列号** (Sequence Number): 消息序列号

### 网络监听

工具使用UDP套接字监听端口8805，这是PFCP协议的标准端口。程序会：

1. 创建UDP监听器
2. 设置读取超时以避免阻塞
3. 解析接收到的数据包
4. 提取PFCP消息头信息
5. 更新统计信息并显示结果

## 故障排除

### 常见问题

1. **权限不足**:
   ```
   警告: 此程序需要root权限来捕获网络数据包
   请使用 'sudo go run pfcp_analyzer.go' 运行
   ```
   解决方案: 使用sudo运行程序

2. **端口被占用**:
   ```
   无法监听UDP端口: bind: address already in use
   ```
   解决方案: 检查是否有其他程序占用8805端口

3. **没有PFCP流量**:
   确保网络中有PFCP流量，通常来自5G核心网络设备

### 调试模式

如果需要更详细的调试信息，可以修改代码添加更多日志输出。

## 扩展功能

### 可添加的功能

1. **数据包过滤**: 按IP地址、消息类型过滤
2. **数据导出**: 将捕获的数据导出为PCAP或CSV格式
3. **图形界面**: 添加Web界面或GUI
4. **告警功能**: 检测异常流量并发送告警
5. **历史记录**: 保存历史数据用于分析

### 自定义配置

可以修改以下参数：

- 监听端口（默认8805）
- 统计信息更新频率（默认30秒）
- 原始数据显示长度（默认32字节）
- 缓冲区大小（默认4096字节）

## 许可证

此工具仅供学习和研究使用。在生产环境中使用前，请确保符合相关法律法规和网络政策。 