# MQTT封包監控工具 (目標IP版本)

這個工具用於監控發送到特定目標IP的MQTT封包，統計每15秒內的不同IMSI數量。

## 功能特點

- 使用 "any" 介面監控所有網路流量，不需要MQTT訂閱
- 捕獲發送到特定目標IP的MQTT封包
- 按目標IP過濾封包
- 統計每15秒內不同的IMSI數量
- 提供詳細的統計報告
- 支持調試模式
- 精確的目標IP監控

## 系統要求

- Linux系統
- Go 1.16或更高版本
- libpcap開發庫
- root權限（用於封包捕獲）

## 安裝依賴

```bash
# 安裝libpcap開發庫
sudo apt-get install libpcap-dev

# 安裝Go依賴
go get github.com/google/gopacket
```

## 配置參數

在 `getMqtt.go` 文件中可以修改以下配置：

```go
var (
    targetIP      = "10.1.153.153" // 目標IP，根據需要修改
    statsInterval = 15 * time.Second // 統計間隔
    debugMode     = false            // 調試模式
)
```

**注意**：程序監控發送到指定目標IP的MQTT封包，使用BPF過濾器精確過濾流量。

## 使用方法

1. 編譯程序：
```bash
go build getMqtt.go
```

2. 以root權限運行：
```bash
sudo ./getMqtt
```

## 輸出示例

```
MQTT封包監控工具 (目標IP版本)
================================
開始監控發送到 10.1.153.153 的MQTT封包...
開始監控 any 介面的MQTT流量
監控目標IP: 10.1.153.153
統計間隔: 15s
過濾器: tcp port 1883 and dst host 10.1.153.153

=== 2024-01-15 14:30:15 統計報告 ===
目標IP: 10.1.153.153
  封包總數: 25
  獨立IMSI數量: 8
  IMSI列表: [460001234567890, 460001234567891, 460001234567892, ...]
```

## 故障排除

1. **權限錯誤**：確保使用 `sudo` 運行程序
2. **any介面錯誤**：如果無法打開any介面，程序會列出可用的網路介面
3. **沒有捕獲到封包**：
   - 檢查目標IP是否正確
   - 確認有MQTT流量發送到目標IP
   - 檢查防火牆設置
   - 確認目標IP在網路中可達

## 調試模式

啟用調試模式可以查看詳細的封包處理信息：

```go
debugMode = true
```

調試模式會顯示：
- 封包處理計數
- 網路層解析信息
- IP和端口過濾信息
- JSON解析錯誤

## 注意事項

- 此工具需要root權限來捕獲網路封包
- 只監控發送到指定目標IP的MQTT流量（端口1883）
- 只處理JSON格式的MQTT消息
- 統計會每15秒重置一次
- 使用BPF過濾器精確過濾目標IP的流量
- 只統計發送到目標IP的封包，不統計來自目標IP的封包 